window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p134","name":"admin.sp_mysql_to_sql_ddl","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"ARC Data Warehouse","id":"d6"}},{"field":"Schema","value":"admin"},{"field":"Name","value":"sp_mysql_to_sql_ddl"},{"field":"Type","value":"Procedure"}],"script":"--SET QUOTED_IDENTIFIER ON|OFF\r\n--SET ANSI_NULLS ON|OFF\r\n--GO\r\nCREATE PROCEDURE [admin].[sp_mysql_to_sql_ddl]\r\nAS\r\nBEGIN\r\n\r\nDROP TABLE IF EXISTS stg.t_mysql_create_table\r\nSELECT id, row_content INTO stg.t_mysql_create_table FROM stg.t_mysql_raw_backup WHERE LEFT(row_content,13) <> 'INSERT INTO `' \r\nORDER BY id\r\n\r\nDELETE FROM stg.t_mysql_raw_backup\r\nWHERE LEFT(row_content,13) <> 'INSERT INTO `'\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,2) = '--'\r\n-- deleted row = 4692\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,2) = '/*'\r\n-- delete row = 4563\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,13) = '  CONSTRAINT '\r\n-- delete row = 1162\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,13) = '  PRIMARY KEY'\r\n-- delete row = 765\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,13) = 'LOCK TABLES `'\r\n-- delete row = 774\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,13) = 'UNLOCK TABLES'\r\n-- delete row = 774\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,13) = '  FULLTEXT KE'\r\n-- delete row = 9\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,13) = '  UNIQUE KEY '\r\n-- delete row = 43\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,12) = 'DELIMITER ;;'\r\n-- delete row = 43\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,7) = '  KEY `'\r\n-- delete row = 1422\r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,4) = 'SET '\r\n-- delete row = \r\n------------------------------------------------------------\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,4) = '    '\r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,5) = '  \t\t\t'\r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,3) = '\t\t\t'\r\n-- delete row = \r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,11) = 'DELIMITER ;'\r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,7) = ' 1 AS `'\r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,10) = '  END */;;'\r\n\r\nPRINT 'END */;;'\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,8) = 'END */;;'\r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,14) = '  INSERT INTO '\r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,13) = '  UPDATE unit'\r\n\r\nDELETE FROM stg.t_mysql_create_table\r\nWHERE LEFT(row_content,14) = '  DELETE FROM '\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = ')'\r\nWHERE LEFT(row_content,20) = ') ENGINE=InnoDB DEFA'\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = ')'\r\nWHERE LEFT(row_content,20) = ') ENGINE=InnoDB AUTO'\r\n\r\n------------------------------------------------------------\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = ')'\r\nWHERE LEFT(row_content,20) = ') ENGINE=MyISAM defa'\r\n\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'CREATE TABLE `','CREATE TABLE stg.')\r\nWHERE LEFT(row_content,14) = 'CREATE TABLE `'\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'CHARACTER SET latin1','') \r\nWHERE CHARINDEX('CHARACTER SET latin1', row_content) > 0\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'COLLATE utf8_unicode_ci','')\r\nWHERE CHARINDEX('COLLATE utf8_unicode_ci', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' CHARACTER SET utf8 ','')\r\nWHERE CHARINDEX(' CHARACTER SET utf8 ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'CHARACTER SET utf8 COLLATE utf8_bin ',' ')\r\nWHERE CHARINDEX('CHARACTER SET utf8 COLLATE utf8_bin ', row_content) > 0\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'tinyint(1)','tinyint')\r\nWHERE CHARINDEX('tinyint(1)', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' timestamp ',' datetime ')\r\nWHERE CHARINDEX(' timestamp ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' tinyint(4) ',' tinyint ')\r\nWHERE CHARINDEX(' tinyint(4) ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' mediumint(9) ',' tinyint ')\r\nWHERE CHARINDEX(' mediumint(9) ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' blob,','  NVARCHAR(MAX), ')\r\nWHERE CHARINDEX(' blob,', row_content) > 0\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'int(11)','int')\r\nWHERE CHARINDEX('int(11)', row_content) > 0\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'DEFAULT ``','DEFAULT ''''')\r\nWHERE CHARINDEX('DEFAULT ``', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'int(10)','int')\r\nWHERE CHARINDEX('int(10)', row_content) > 0\r\n \r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'DROP TABLE IF EXISTS `','DROP TABLE IF EXISTS stg.')\r\nWHERE CHARINDEX('DROP TABLE IF EXISTS `', row_content) > 0\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'AUTO_INCREMENT','IDENTITY(1,1)')\r\nWHERE CHARINDEX('AUTO_INCREMENT', row_content) > 0\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' mediumtext ,',' text NULL,')\r\nWHERE CHARINDEX(' mediumtext ,', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP','')\r\nWHERE CHARINDEX('DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'smallint(6)','smallint')\r\nWHERE CHARINDEX('smallint(6)', row_content) > 0\r\n\r\n--UPDATE stg.t_mysql_create_table\r\n--SET row_content = REPLACE(row_content,'.week','.[week]')\r\n--WHERE CHARINDEX('.week', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' primary ',' [primary] ')\r\nWHERE CHARINDEX(' primary ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' value ',' [value] ')\r\nWHERE CHARINDEX(' value ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' public ',' [public] ')\r\nWHERE CHARINDEX(' public ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' longtext ',' text')\r\nWHERE CHARINDEX(' longtext ', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' tinyint DEFAULT ''0''',' tinyint DEFAULT (0) ')\r\nWHERE CHARINDEX(' tinyint DEFAULT ''0''', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' tinyint DEFAULT ''1''',' tinyint DEFAULT (1) ')\r\nWHERE CHARINDEX(' tinyint DEFAULT ''1''', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' tinyint NOT NULL DEFAULT ''0''',' tinyint NOT NULL DEFAULT (0) ')\r\nWHERE CHARINDEX(' tinyint NOT NULL DEFAULT ''0''', row_content) > 0\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' tinyint NOT NULL DEFAULT ''1''',' tinyint NOT NULL DEFAULT (1) ')\r\nWHERE CHARINDEX(' tinyint NOT NULL DEFAULT ''1''', row_content) > 0\r\n------------------------------------------------------------\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'`','')\r\nWHERE CHARINDEX('`', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT 'key'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' key ',' [key] ')\r\nWHERE CHARINDEX(' key ', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT 'enabled tinyint DE'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' enabled tinyint DE',' [enabled] tinyint DE')\r\nWHERE CHARINDEX(' enabled tinyint DE', row_content) > 0\r\n------------------------------------------------------------\r\n------------------------------------------------------------\r\nPRINT ' public tinyint DE'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' public tinyint DE',' [public] tinyint DE')\r\nWHERE CHARINDEX(' public tinyint DE', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT 'default tinyint'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' default tinyint ',' [default] tinyint ')\r\nWHERE CHARINDEX(' default tinyint ', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT 'COLLATE utf8_bin '\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,'COLLATE utf8_bin ',' ')\r\nWHERE CHARINDEX('COLLATE utf8_bin ', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT ') ENGINE=MyISAM IDENTITY(1,1)'\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = ')'\r\nWHERE LEFT(row_content,20) = ') ENGINE=MyISAM IDEN'\r\n------------------------------------------------------------\r\nPRINT ' function varchar(30) '\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' function varchar(30) ',' [function] varchar(30) ')\r\nWHERE CHARINDEX(' function varchar(30) ', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT 'open'\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' open ',' [open] ')\r\nWHERE CHARINDEX(' open ', row_content) > 0\r\n\r\n------------------------------------------------------------\r\nPRINT ' primary tinyint DEF'\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' primary tinyint DEF',' [primary] tinyint DEF')\r\nWHERE CHARINDEX(' primary tinyint DEF', row_content) > 0\r\n\r\n------------------------------------------------------------\r\nPRINT ' primary tinyint NOT NULL DE'\r\n\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' primary tinyint NOT NULL DE',' [primary] tinyint NOT NULL DE')\r\nWHERE CHARINDEX(' primary tinyint NOT NULL DE', row_content) > 0\r\n\r\n------------------------------------------------------------\r\nPRINT 'read'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' read ',' [read] ')\r\nWHERE CHARINDEX(' read ', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT ' from date default'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' from date default',' [from] date default')\r\nWHERE CHARINDEX(' from date default', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT ' to date default'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' to date default',' [to] date default')\r\nWHERE CHARINDEX(' to date default', row_content) > 0\r\n\r\n------------------------------------------------------------\r\nPRINT 'int unsigned NOT'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' int unsigned NOT',' int NOT')\r\nWHERE CHARINDEX(' int unsigned NOT', row_content) > 0\r\n------------------------------------------------------------\r\nPRINT ' IDENTITY(1,1),'\r\nUPDATE stg.t_mysql_create_table\r\nSET row_content = REPLACE(row_content,' IDENTITY(1,1),',', ')\r\nWHERE CHARINDEX(' IDENTITY(1,1),', row_content) > 0\r\n\r\n\r\nEND","parameters":[],"dependencies":null,"imported_at":"2021-08-04 00:01"};