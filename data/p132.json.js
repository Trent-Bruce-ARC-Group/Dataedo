window.repositoryObject = {"parameters_custom_fields":[],"object_id":"p132","name":"admin.sp_create_jobready_stage_tables","subtype":"PROCEDURE","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"ARC Data Warehouse","id":"d6"}},{"field":"Schema","value":"admin"},{"field":"Name","value":"sp_create_jobready_stage_tables"},{"field":"Type","value":"Procedure"}],"script":"--SET QUOTED_IDENTIFIER ON|OFF\r\n--SET ANSI_NULLS ON|OFF\r\n--GO\r\nCREATE PROCEDURE [admin].[sp_create_jobready_stage_tables]\r\nAS\r\nBEGIN\r\n    DECLARE @nStartId INT, @nEndId INT, @cSQL VARCHAR(MAX);\r\n    DECLARE cur_create_stage_table CURSOR FOR\r\n\t\tSELECT id AS start_id, LEAD(id) OVER (ORDER BY id) - 1 AS end_id\r\n\t\tFROM stg.t_mysql_create_table\r\n\t\tWHERE LEFT(row_content, 6) = 'DROP T'\r\n\t\tORDER BY id;\r\n    OPEN cur_create_stage_table;\r\n    FETCH NEXT FROM cur_create_stage_table\r\n    INTO @nStartId, @nEndId;\r\n\r\n    WHILE @@FETCH_STATUS = 0\r\n    BEGIN\r\n        SELECT @cSQL = @cSQL + ' ' + row_content\r\n        FROM stg.t_mysql_create_table\r\n        WHERE id BETWEEN @nStartId AND @nEndId;\r\n        EXEC (@cSQL);\r\n        SET @cSQL = '';\r\n        FETCH NEXT FROM cur_create_stage_table\r\n        INTO @nStartId, @nEndId;\r\n    END;\r\n    CLOSE cur_create_stage_table;\r\n    DEALLOCATE cur_create_stage_table;\r\n\r\nEND;","parameters":[],"dependencies":null,"imported_at":"2021-08-04 00:01"};